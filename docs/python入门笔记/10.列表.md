# 列表

Python里面相当有用的一种内置类型：列表。



## 列表也是序列

和字符串差不多，列表是一系列的数值的序列。在字符串里面，这些值是字符；在列表里面，这些值可以是任意类型的。一个列表中的值一般叫做列表的元素，有时候也叫列表项。

创建一个新的列表的最简单的方法就是把列表的元素用方括号包含起来：

```python
[1,2,3,4,5]
['python','java','C','C++','C#','PHP']
```

列表内部可以包含一个列表作为元素，这种包含列表的列表也叫做网状列表

```python
['python','java',['C','C++','C#']]
```

不含有任何元素的列表叫做空列表，可以就用空的方括号来建立一个。

列表的值可以赋给变量

```python
language = ['python','java',['C','C++','C#']]
print(language)
```



## 列表元素可以修改

读取列表元素的语法就如同读取字符串中的字符一样——用方括号运算符就可以了。方括号内的数字用来确定索引位置。Python是从零开始计数的。

```python
language[0]
'python'
```

和字符串不同的是，列表是可以修改的。方括号运算符放到一个赋值语句的等号左侧的时候，就会把对应位置的列表元素重新赋值。

```python
language = ['python','java',['C','C++','C#']]
language[0] = 'javascript'
print(language)
['javascript','java',['C','C++','C#']]
```

列表的索引和字符串的索引的格式是一样的：

- 任意的一个整型表达式，都可以用来作为索引编号；

- 如果试图读取或者写入一个不存在的列表元素，会得到一个索引错误的提示；

- 如果一个索引是负值，意味着是从列表末尾向前倒序计数查找相对应的位置。

```python
languages = ['python', 'java', 'javascript']
'python' in languages
True
```



## 遍历一个列表

遍历列表中所有元素最常用的方法就是for循环，和遍历字符串的时候用的是同一个语法；

```python
for language in languages:
    print(language)
```

如果需要写入或者更新这些元素，还是需要用到索引。一般来说，需要把两个内置函数range和len结合起来使用：

```python
for i in range(len(languages)):
    languages[i] = languages[i] * 2
```

这个循环遍历了列表，然后对每个元素都进行了更新。len函数返回的是列表中元素的数量。range返回的是列表的一系列索引，从0到n-1，n就是整个列表的长度了。每次循环的时候，i都会得到下一个元素的索引值。在循环体内部的赋值语句每次都通过i作为索引值来读钙元素的旧值，进行修改然后赋新值给该元素。

空列表的for循环中，循环体是永远不会运行的：

```python
for x in []:
    print('This never happens!')
```

尽管列表中可以插入另外一个列表，但这种网状的分支列表依然只会算作一个元素，因此下面这个列表的长度是3：

```python
['python', 'java', ['C', 'C++', 'C#']]
```



## 列表运算符

加号+运算符可以把列表拼接在一起：

```python
a = [1, 2, 3]
b = [4, 5, 6]
c = a + b
```

星号*运算符可以将列表重复指定的次数：

```python
['python'] * 4
```



## 列表切片

切片操作符也可以用到列表上：

```python
t = ['a', 'b', 'c', 'd', 'e', 'f']
t[1:3]
t[:4]
t[3:]
t[:]
```

切片运算中，如果你省略了第一个索引，切片就会从头开始。如果省略了第二个，切片就会一直走到末尾。如果你把两个都省略了，这个切片就是整个列表的一个复制。

因为列表是可以修改的，所以在进行运算修改列表之前，做个复制来备份经常是很有必要的。

切片运算符放到赋值语句中等号左边的时候可以对多个元素进行更新：

```python
t = ['a', 'b', 'c', 'd', 'e', 'f']
t[1:3] = ['x', 'y']
t
['a', 'x', 'y', 'd', 'e', 'f']
```



## 列表的方法

Python为操作列表提供了很多方法。比如append就可以在列表末尾添加一个新的元素：

```python
t = ['a', 'b', 'c']
t.append('d')
t
['a', 'b', 'c', 'd']
```

extend使用另一个列表做参数，然后把所有的元素添加到一个列表上：

```python
t1 = ['a', 'b', 'c']
t2 = ['d', 'e']
t1.extend(t2)
t1
['a', 'b', 'c', 'd', 'e']
```

上面这个例子中t2是没有修改过的。

sort把列表中的元素从低到高（按照ASCII码的大小从小到大）排列：

```python
t = ['d', 'c', 'e', 'b', 'a']
t.sort()
t
['a' ,'b', 'c', 'd', 'e']
```

大多数列表的方法都是无返回值的；这些方法都对列表进行修改，返回的是空。如果不小心写出了一个t = t.sort()，t就被清空了。



## map, filter, reduce列表中最重要的三种运算

得到列表中所有值的综合，可以用下面的循环来实现：

```python
def add_all(t):
    total = 0
    for x in t:
        total += x
    return total
```

随着循环的运行，total积累了所有元素的综合，这种变量也叫做累加器。

把列表中所有元素加起来是一种很常用的运算，所以Python提供了内置的函数sum:

```python
t = [1, 2, 3]
sum(t)
```

把一系列列表元素组合成一个单值的运算，也叫做reduce。

下面这个函数就是接收一个字符串列表，将所有字符串变为大写字母组成的，然后返回一个这些大写字符串组成的新列表：

```python
def capitalize_all(t):
    res = []
    for s in t:
        res.append(s.capitalize())
    return res
```

像上面这个capitalize_all的运算也叫做一个map，因为这种运算将某一函数应用到一个序列中的每个元素上。

下面这个函数接收一个字符串列表，然后返回一个其中只包含大写字母的字符串所组成的列表：

```python
def only_upper(t):
    res = []
    for s in t:
        if s.isupper():
            res.append(s)
    return res
```

isupper是一个字符串方法，如果字符串中只包含大写字母就会返回真。

only_upper这样的运算也叫filter，因为这种运算筛选出特定的元素，过滤掉其他的。

常用的列表运算都可以表示成map、filter以及reduce的组合。



## 删除元素

从一个列表中删除元素有几种方法。如果你知道你要删除的元素的索引，就可以用pop方法来实现：

```python
t = ['a', 'b', 'c']
x = t.pop(1)
t
['a', 'c']
x
'b'
```

pop修改列表，然后返回删除的元素。如果你不指定一个索引位置，pop就会删除和返回最后一个元素。

如果不需要删掉的值了，可以用del运算符来实现：

```python
>>> t = ['a', 'b', 'c']
>>> del t[1]
>>> t
['a', 'c']
```

如果知道要删除的元素的值，但不知道索引位置，可以使用remove这个方法：

```python
t = ['a', 'b', 'c']
t.remove('b')
```

remove的返回值是空。

要删除更多元素，可以使用del和切片索引：

```python
t = ['a', 'b', 'c', 'd', 'e', 'f']
del t[1:5]
t
['a', 'f']
```

和之前我们看到的一样，切片是含头不含尾。



## 列表和字符串

字符串是一系列字符的序列，而列表是一系列值的序列，但一个由字符组成的列表是不同于字符串的。要把一个字符串转换成字符列表，可以用list函数：

```python
s = 'python'
t = list(s)
t
['p', 'y', 't', 'h', 'o', 'n']
```

list是一个内置函数的名字，所以应该避免用它来作为变量名。

list这个函数将一个字符串分开成一个个字母。如果想把字符串切分成一个个单词，可以用split这个方法：

```python
s = 'python java go'
t = s.split()
['python', 'java', 'go']
```

可选的参数是定界符，是用来确定单词边界的。下面这个例子中就是把连接号-作为定界符：

```python
s = 'python-java-go'
delimiter = '-'
t = s.split(delimiter)
t
['python', 'java', 'go']
```

join是与split功能相反的一个方法。他接收一个字符串列表，然后把所有元素拼接到一起。join是一个字符串方法，所以必须把join放到定界符后面来用，并且传递一个列表作为参数：

```python
t = ['python', 'java', 'go']
delimiter = ' '
s = delimiter.join(t)
s
```



## 对象和值

要检查两个变量是否指向的是同一个对象，可以用is运算符。

```python
a = 'python'
b = 'python'
a is b 
True
```

在上面这个例子中，Python只建立了一个字符串对象，然后a和b都指向它。但当你建立两个列表的时候，得到的就是两个对象了：

```python
a = [1, 2, 3]
b = [1, 2, 3]
a is b 
False
```

在这个情况下，我们可以说两个列表是相等的，因为它们有相同的元素，但它们不是同一个列表，因为它们并不是同一个对象。

如果两个对象是同一个对象，那它们必然是相等的；但如果它们相等，却未必是同一个对象。

目前一直把对象和值来随意交换使用，但实际上更确切的说法是一个对象拥有一个值。如果你计算[1,2,3]，你得到一个列表对象，整个列表对象的整个值是一个整数序列。如果另外一个列表有相同的元素，我们称之含有相同的值，但并不是相同的对象。



## 别名

如果a是一个对象了，然后你赋值b=a，那么这两个变量都指向同一个对象：

```python
a = [1, 2, 3]
b = a
b is a
True
```

一个变量和一个对象的关系叫做引用。在上面这个例子中，a和b是对同一对象的两个引用。

这样一个对象有不止一个引用，就也有了不止一个名字了，所以就说这个对象有别名了。

如果一个别名对象是可修改的，那么对一个别名做出的修改就会影响到其他引用：

```python
a = [1, 2, 3]
b = a
b[0] = 42
a
[42, 2, 3]
```

上面这个很容易让初学者犯错，一般来讲，处理可变对象的时候，尽量避免别名使用，这样更安全。

对于不可变对象，比如字符串来说，别名使用就不是太大问题了，如下所示：

```python
>>> a = 'python'
>>> b = a
>>> b = 'abc'
>>> a
'python'
>>> b
'abc'
```



## 列表参数

当传递一个列表给一个函数的时候，函数得到的是对该列表的一个引用。如果函数修改了列表，调用者会看到变化的。

```python
def delete_head(t):
    del t[0]

>>> letters = ['a', 'b', 'c']
>>> delete_head(letters)
>>> letters
['b', 'c']
```

形式参数t和变量letters都是同一对象的别名。

务必要区分修改列表的运算和产生新列表的运算，特别重要。

比如append方法修改一个列表，单加号+运算符是产生一个新列表。

```python
>>>t1 = [1, 2]
>>> t2 = t1.append(3)
>>> t1
[1, 2, 3]
>>> t2
None
```

append修改了列表，返回的是空。

```python
>>> t3 = t1 + [4]
>>> t1
[1, 2, 3]
>>> t3
[1, 2, 3, 4]
>>> t1
[1, 2, 3]
```

加号+运算符创建了新的列表，并不修改源列表。



## 调试

- 大多数列表方法都修改参数，返回空值。这正好与字符串方法相反，字符串的方法都是返回一个新字符串，保持源字符串不变。

  例如下述代码就可能和我们的预想不同：

  ```python
  t = t.sort()
  ```

  因为sort返回的是空值，所以对t的后续运算都会失败。

  在使用列表的方法和运算符之前，应当读一下文档，然后在交互模式中对它们进行一下测试。

- 选一种方法并坚持使用。

  列表使用的问题中很大一部分是因为有太多方法来实现导致的。例如要从一个列表中删除一个元素，可以用pop，remove，del甚至简单的切片操作。

  要增加一个元素，可以用append方法或者加号+运算符，假设t是一个列表，而x是一个列表元素，下面代码都是正确的：

  ```python
  t.append(x)
  t = t + [x]
  t += [x]
  ```

  错误的如下：

  ```python
  t.append([x])
  t = t.append(x)
  t + [x]
  t = t + x
  ```

- 尽量做备份，避免用别名。

  如果用sort这样的方法来修改参数，又要同事保留源列表，可以先做个备份：

  ```python
  >>> t = [3, 1, 2]
  >>> t2 = t[:]
  >>> t2.sort()
  >>> t
  [3, 1, 2]
  >>> t2
  [1, 2, 3]
  ```



## 部分术语列表

- 列表：一系列值的序列。
- 元素：一个列表或者其他序列中的值，也叫项。

- reduce：一种处理模式，遍历一个序列，把元素积累起来结合成一个单独的结果。

- map：一种处理模式，遍历一个序列，对每一个元素都进行某种运算。

- filter：一种处理模式，遍历一个列表，选取其中满足特定规则的一些元素。

- 对象：变量所指向的就是对象。一个对象有特定的某个类型，以及一个值。



**重要的事情说三遍：练习！练习！练习！**

